<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* 重新自己手打一遍 */
        table {
            border-collapse: collapse;
            margin-top: 10px;
            background: #333;
        }

        td {
            width: 30px;
            height: 30px;
            border: solid 1px black;
        }

        /* 先把颜色复制粘贴下 */
        td.c1 {
            /* 以后学习渐变色，你先抄老师的 */
            background: -webkit-linear-gradient(bottom right, rgb(182, 44, 44), rgb(250, 6, 6));
        }

        td.c2 {
            /* 以后学习渐变色，你先抄老师的 */
            background: -webkit-linear-gradient(bottom right, rgb(255, 157, 0), rgb(230, 201, 42));
        }

        td.c3 {
            /* 以后学习渐变色，你先抄老师的 */
            background: -webkit-linear-gradient(bottom right, rgb(239, 243, 6), rgb(213, 243, 41));
        }

        td.c4 {
            /* 以后学习渐变色，你先抄老师的 */
            background: -webkit-linear-gradient(bottom right, rgb(11, 246, 3), rgb(94, 235, 129));
        }

        td.c5 {
            /* 以后学习渐变色，你先抄老师的 */
            background: -webkit-linear-gradient(bottom right, rgb(0, 225, 255), rgb(62, 233, 248));
        }

        td.c6 {
            /* 以后学习渐变色，你先抄老师的 */
            background: -webkit-linear-gradient(bottom right, rgb(0, 98, 255), rgb(79, 137, 243));
        }

        td.c7 {
            /* 以后学习渐变色，你先抄老师的 */
            background: -webkit-linear-gradient(bottom right, rgb(98, 0, 255), rgb(146, 78, 235));
        }
    </style>
</head>

<body>
    <!-- 一言不合就重新打一遍俄罗斯方块 -->
    <table id='table'>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
    <script>
        // 先得到表格
        var table = document.getElementById('table');
        //************************************************ 
        //                 函数定义区域  
        //************************************************ 
        // 染色函数
        function fillColor(row, col, color) {
            table.getElementsByTagName('tr')[row].getElementsByTagName('td')[col].className = 'c' + color;
        }
        // 画砖头
        function drawElement() {
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if (element[i][j] != 0)
                        fillColor(i + row, j + col, element[i][j]);
                };
            };
        };
        // 清屏
        function clearScreen() {
            for (var i = 0; i < 20; i++) {
                for (var j = 0; j < 12; j++) {
                    fillColor(i, j, 0);
                };
            };
        }
        // 画地图
        function drawMap() {
            for (var i = 0; i < 20; i++) {
                for (var j = 0; j < 12; j++) {
                    if (map[i][j] != 0)
                        fillColor(i, j, map[i][j]);
                };
            };
        };
        // 死在地图上
        function dieInMap() {
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if (element[i][j] != 0)
                        map[i + row][j + col] = element[i][j];
                };
            };
        };
        // 是否停住
        function judgeStop() {
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if (element[i][j] != 0 && map[i + row + 1][j + col] != 0)
                        return false;
                };
            };
            return true;
        }
        // 随机生成任意的砖头
        function randomBlock() {
            var n = parseInt(Math.random() * 7);
            element = allblock[n];
        }
        // 旋转函数
        function rotate() {
            //为rotate准备空数组,并且你不能把rotatePreArry作为全局变量，因为你每次都要清空它
            // 如果不清空它，上一次旋转过的数组残留会影响这次的旋转
            var rotaPreArry = [
                [],
                [],
                [],
                []
            ]
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    rotaPreArry[j][3 - i] = element[i][j]
                };
            };
            // 由于旋转的时候需要判断是否可以旋转
            // 设置变量
            var canRotate = true;
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if (rotaPreArry[i][j] != 0 && map[i + row + 1][j + col] != 0)
                        canRotate = false;
                };
            };
            if (canRotate) {
                element = rotaPreArry;
            }

        };
        // 左移和判断是否可以左移
        function moveLeft() {
            var canLeft = true;
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if (element[i][j] != 0 && map[i + row + 1][j + col - 1] != 0)
                        canLeft = false;
                };
            };
            if (canLeft) {
                col--
            }
        }
        // 右移和判断是否可以右移
        function moveRight() {
            var canRight = true;
            for (var i = 0; i < 4; i++) {
                for (var j = 0; j < 4; j++) {
                    if (element[i][j] != 0 && map[i + row + 1][j + col + 1] != 0)
                        canRight = false;
                };
            };
            if (canRight) {
                col++
            }
        }
        //消除行
        function clearRow() {
            var count = 0;
            for (var i = 0; i < 20; i++) {
                for (var j = 0; j < 12; j++) {
                    if (map[i][j] != 0)
                        count++
                };
                if(count == 12){
                    for (var k = 0; k < 12; k++) {
                        map[i][k] = 0;
                    };
                };
            };
        }

        //
        //************************************************ 
        //                 全局变量 
        //************************************************ 

        // 砖头的变量先定义
        var element;
        // 列出所有砖头的可能性
        var allblock = [
            [
                [0, 1, 0, 0],
                [0, 1, 0, 0],
                [0, 1, 1, 0],
                [0, 0, 0, 0]

            ],
            [
                [0, 2, 0, 0],
                [0, 2, 0, 0],
                [0, 2, 0, 0],
                [0, 2, 0, 0]

            ],
            [
                [0, 3, 0, 0],
                [0, 3, 0, 0],
                [3, 3, 0, 0],
                [0, 0, 0, 0]

            ],
            [
                [4, 4, 4, 0],
                [0, 4, 0, 0],
                [0, 0, 0, 0],
                [0, 0, 0, 0]

            ],
            [
                [0, 0, 0, 0],
                [5, 5, 0, 0],
                [0, 5, 5, 0],
                [0, 0, 0, 0]

            ],
            [
                [0, 0, 0, 0],
                [0, 6, 6, 0],
                [6, 6, 0, 0],
                [0, 0, 0, 0]

            ],
            [
                [0, 0, 0, 0],
                [0, 1, 1, 0],
                [0, 1, 1, 0],
                [0, 0, 0, 0]

            ]
        ];


        // 画个地图
        // 底部有一个最后4 row 用来垫地面，让最差的情况下也能判定砖头不下落
        var map = [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0],
            [0, 0, 2, 4, 4, 4, 0, 1, 1, 0, 0, 0],
            [0, 0, 2, 2, 3, 3, 6, 7, 0, 0, 0, 0],
            [0, 1, 1, 3, 2, 3, 5, 7, 1, 1, 0, 0],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        ];
        // 接着画砖头并封装到函数里

        // 用来变化行和列
        var row = 0;
        var col = 4;
        // 用来判断能否下落
        var canfall;
        //************************************************ 
        //                 调用区域 
        //************************************************ 

        // 调用函数把element先生成出来
        randomBlock();
        // 然后把砖头element画到map上
        drawElement(row, col);
        // 同时生成map
        drawMap();

        //************************************************ 
        //                 问题区域  
        //************************************************ 

        //************************************************ 
        //                 定时器区域  
        //************************************************ 
        setInterval(function () {

            canfall = judgeStop();
            if (canfall) {
                // 如果可以下落，则下落
                row++;
            } else {
                // 如果不能下落，需要他死再地图上面
                dieInMap()
                // 重新有砖头下落
                row = 0;
                col = 4;
                randomBlock();
            }
            //判断是否消行
            clearRow();
            // 清屏
            clearScreen();
            // 画砖头
            drawElement(row, col);
            // 画地图
            drawMap();
            // 

        }, 500);
        //************************************************ 
        //                 事件监听  
        //************************************************ 
        document.onkeydown = function (e) {
            if (e.keyCode == 38) {
                //
                rotate();
                // 因为下一帧才旋转，故要重新
                clearRow();
                // 清屏
                clearScreen();
                // 画砖头
                drawElement(row, col);
                // 画地图
                drawMap();
            } else if (e.keyCode == 37) {
                //
                moveLeft();
                // 因为下一帧才旋转，故要重新
                clearRow();
                // 清屏
                clearScreen();
                // 画砖头
                drawElement(row, col);
                // 画地图
                drawMap();
            } else if (e.keyCode == 39) {
                //
                moveRight();
                // 因为下一帧才旋转，故要重新
                clearRow();
                // 清屏
                clearScreen();
                // 画砖头
                drawElement(row, col);
                // 画地图
                drawMap();
            } else if (e.keyCode == 32) {
                //
                while (true) {
                    canfall = judgeStop();
                    if (canfall) {
                        row++;
                    } else {
                        break;
                    }
                }
                clearRow();
            }
        };
    </script>
</body>

</html>